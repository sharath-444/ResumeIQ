{% extends "base.html" %}

{% block content %}
<div class="min-h-screen pt-28 pb-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto">

        <div class="flex justify-between items-end mb-10 border-b border-white/10 pb-6">
            <div>
                <h1 class="text-3xl font-bold text-white mb-2"><span class="text-purple">Top</span> Candidates</h1>
                <p class="text-gray-400">Filter and shortlist the best talent</p>
            </div>
            <a href="{{ url_for('admin.dashboard') }}"
                class="text-gray-400 hover:text-white transition bg-white/5 border border-white/10 px-4 py-2 rounded-lg text-sm">
                <i class="fa-solid fa-arrow-left mr-2"></i> Dashboard
            </a>
        </div>

        <!-- Filters -->
        <div class="glass-panel p-6 rounded-2xl mb-12">
            <form method="GET" action="{{ url_for('admin.candidates') }}" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <label class="block text-gray-400 text-sm font-bold mb-2">Target Role</label>
                    <select name="role"
                        class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-neon transition">
                        <option value="All" {% if selected_role=='All' %}selected{% endif %}>All Roles</option>
                        {% for category, roles in target_roles.items() %}
                        <optgroup label="{{ category }}">
                            {% for role in roles %}
                            <option value="{{ role }}" {% if selected_role==role %}selected{% endif %}>{{ role }}
                            </option>
                            {% endfor %}
                        </optgroup>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label class="block text-gray-400 text-sm font-bold mb-2">Minimum Score</label>
                    <input type="number" name="score_min" value="{{ selected_score }}" min="0" max="100"
                        class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-neon transition">
                </div>
                <div class="flex items-end">
                    <button type="submit"
                        class="w-full bg-purple text-white px-6 py-2 rounded-lg font-bold hover:bg-white hover:text-black transition shadow-[0_0_15px_rgba(189,0,255,0.4)]">
                        Apply Filters
                    </button>
                </div>
            </form>
        </div>

        <!-- Candidates Table -->
        <div class="glass-panel rounded-2xl overflow-hidden">
            <div class="px-6 py-4 border-b border-white/10 bg-white/5 flex justify-between items-center">
                <h3 class="font-bold text-white">Ranked Candidates</h3>
                <span class="text-xs text-gray-400">{{ candidates|length }} candidates found</span>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm text-gray-400">
                    <thead class="bg-white/5 text-gray-200 uppercase font-bold">
                        <tr>
                            <th class="px-6 py-3">Rank</th>
                            <th class="px-6 py-3">Candidate</th>
                            <th class="px-6 py-3">Role</th>
                            <th class="px-6 py-3">ATS Score</th>
                            <th class="px-6 py-3">Status</th>
                            <th class="px-6 py-3 text-right">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-white/5">
                        {% for resume in candidates %}
                        <tr class="hover:bg-white/5 transition {% if resume.is_shortlisted %}bg-purple/5{% endif %}">
                            <td class="px-6 py-4 font-bold text-purple">{{ loop.index }}</td>
                            <td class="px-6 py-4">
                                <div class="font-medium text-white">{{ resume.owner.username }}</div>
                                <div class="text-xs text-gray-500">{{ resume.filename }}</div>
                            </td>
                            <td class="px-6 py-4">
                                <span class="bg-white/5 border border-white/10 px-2 py-1 rounded text-xs">{{
                                    resume.role_applied }}</span>
                            </td>
                            <td class="px-6 py-4">
                                <div class="flex items-center space-x-2">
                                    <div class="w-12 h-1.5 bg-white/10 rounded-full overflow-hidden">
                                        <div class="h-full {{ 'bg-green-400' if resume.score >= 80 else 'bg-yellow-400' }}"
                                            style="width: {{ resume.score }}%"></div>
                                    </div>
                                    <span
                                        class="font-bold {{ 'text-green-400' if resume.score >= 80 else 'text-yellow-400' }}">{{
                                        resume.score }}</span>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                {% if resume.is_shortlisted %}
                                <span class="text-green-400 text-xs flex items-center">
                                    <i class="fa-solid fa-circle-check mr-1"></i> Shortlisted
                                </span>
                                {% else %}
                                <span class="text-gray-600 text-xs">Pending</span>
                                {%- endif %}
                            </td>
                            <td class="px-6 py-4 text-right">
                                <div class="flex justify-end space-x-3">
                                    <a href="{{ url_for('admin.toggle_shortlist', resume_id=resume.id) }}"
                                        class="transition {{ 'text-yellow-500 hover:text-yellow-400' if resume.is_shortlisted else 'text-gray-400 hover:text-purple' }}"
                                        title="{{ 'Remove from shortlist' if resume.is_shortlisted else 'Shortlist' }}">
                                        <i class="fa-{{ 'solid' if resume.is_shortlisted else 'regular' }} fa-star"></i>
                                    </a>
                                    <a href="{{ url_for('main.view_report', resume_id=resume.id) }}"
                                        class="text-neon hover:text-white transition">
                                        <i class="fa-solid fa-file-lines"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="6" class="px-6 py-12 text-center text-gray-500 italic">
                                No candidates match the current filters.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>
{% endblock %}