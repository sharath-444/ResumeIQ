{% extends "base.html" %}

{% block content %}
<div class="min-h-screen pt-28 pb-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-3xl mx-auto">

        <div class="flex justify-between items-end mb-10 border-b border-white/10 pb-6">
            <div>
                <h1
                    class="text-3xl font-bold text-white mb-2 underline decoration-purple decoration-4 underline-offset-8">
                    Batch <span class="text-purple">Analysis</span>
                </h1>
                <p class="text-gray-400">Upload multiple resumes to find the top talent instantly</p>
            </div>
            <a href="{{ url_for('admin.dashboard') }}" class="text-gray-400 hover:text-white transition">
                <i class="fa-solid fa-arrow-left mr-2"></i> Dashboard
            </a>
        </div>

        <div class="glass-panel p-8 rounded-2xl">
            <form action="{{ url_for('admin.upload') }}" method="POST" enctype="multipart/form-data" class="space-y-6">

                <div>
                    <label class="block text-gray-300 text-sm font-bold mb-3">Target Role for this Batch</label>
                    <select name="role" required
                        class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-neon transition appearance-none">
                        {% for category, roles in target_roles.items() %}
                        <optgroup label="{{ category }}" class="bg-[#0b0b1a] text-purple font-bold">
                            {% for role in roles %}
                            <option value="{{ role }}" class="bg-[#0b0b1a] text-white">{{ role }}</option>
                            {% endfor %}
                        </optgroup>
                        {% endfor %}
                    </select>
                </div>

                <div class="relative">
                    <label class="block text-gray-300 text-sm font-bold mb-3">Select Resumes (PDF / DOCX)</label>
                    <div id="drop-zone"
                        class="border-2 border-dashed border-white/10 rounded-2xl p-10 flex flex-col items-center justify-center hover:border-purple/50 transition cursor-pointer bg-white/5 group">
                        <i
                            class="fa-solid fa-cloud-arrow-up text-4xl text-gray-600 mb-4 group-hover:text-purple transition"></i>
                        <p class="text-gray-400 text-center mb-2">Drag and drop multiple files here or <span
                                class="text-purple font-bold">browse</span></p>
                        <p class="text-xs text-gray-600 uppercase tracking-widest">Max 16MB per file</p>
                        <input type="file" name="resumes" id="file-input" multiple required accept=".pdf,.docx"
                            class="hidden">
                    </div>
                </div>

                <div id="file-list" class="space-y-2 max-h-40 overflow-y-auto">
                    <!-- Files will be listed here -->
                </div>

                <button type="submit" id="submit-btn"
                    class="w-full bg-purple text-white py-4 rounded-xl font-bold text-lg hover:bg-white hover:text-black transition shadow-[0_0_20px_rgba(189,0,255,0.3)] flex items-center justify-center space-x-3">
                    <i class="fa-solid fa-bolt"></i>
                    <span>Analyze & Rank Batch</span>
                </button>
            </form>
        </div>

    </div>
</div>

<style>
    #drop-zone.drag-over {
        border-color: #bd00ff;
        background: rgba(189, 0, 255, 0.05);
    }
</style>

<script>
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const fileList = document.getElementById('file-list');
    const submitBtn = document.getElementById('submit-btn');

    dropZone.onclick = () => fileInput.click();

    dropZone.onsubmit = () => {
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin mr-2"></i> Processing...';
    };

    fileInput.onchange = (e) => {
        updateFileList(e.target.files);
    };

    dropZone.ondragover = (e) => {
        e.preventDefault();
        dropZone.classList.add('drag-over');
    };

    dropZone.ondragleave = () => {
        dropZone.classList.remove('drag-over');
    };

    dropZone.ondrop = (e) => {
        e.preventDefault();
        dropZone.classList.remove('drag-over');
        fileInput.files = e.dataTransfer.files;
        updateFileList(e.dataTransfer.files);
    };

    function updateFileList(files) {
        fileList.innerHTML = '';
        if (files.length > 0) {
            Array.from(files).forEach(file => {
                const item = document.createElement('div');
                item.className = 'flex items-center space-x-3 text-sm text-gray-400 bg-white/5 p-2 rounded-lg border border-white/5';
                item.innerHTML = `<i class="fa-regular fa-file-lines text-purple"></i> <span>${file.name}</span> <span class="text-xs text-gray-600 ml-auto">(${(file.size / 1024).toFixed(1)} KB)</span>`;
                fileList.appendChild(item);
            });
        }
    }
</script>
{% endblock %}